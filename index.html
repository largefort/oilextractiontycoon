<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>GeoTycoon Mobile</title>

<!-- Fonts -->
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">

<!-- Leaflet -->
<link rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css">

<!-- Icons + Bootstrap (unchanged) -->
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<link rel="stylesheet" href="stats.css">
<link rel="stylesheet" href="styles.css">

<script async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7136613030546059"
        crossorigin="anonymous"></script>

<style>
/* ===== CORE FIXES FOR TOUCH ===== */

html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    font-family: 'Roboto', sans-serif;
    background-color: #1a1a1a;
    color: #eaeaea;
    overflow: hidden; /* IMPORTANT */
}

/* Leaflet map */
#map {
    height: calc(100% - 60px);
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    touch-action: pan-x pan-y; /* CRITICAL */
}

/* Resource bar */
.resource-container {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(40,40,40,0.95);
    border-radius: 8px;
    padding: 5px 10px;
    display: flex;
    width: 95%;
    max-width: 600px;
    z-index: 5;
    font-size: 11px;
}

.resource { flex: 1; text-align: center; }

/* News ticker */
.news-ticker-container {
    position: fixed;
    top: 45px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(20,20,20,0.9);
    padding: 5px 15px;
    border-radius: 8px;
    z-index: 4;
    width: 100%;
    max-width: 600px;
    overflow: hidden;
}

.news-ticker {
    white-space: nowrap;
    animation: scroll-left 15s linear infinite;
}

@keyframes scroll-left {
    from { transform: translateX(100%); }
    to   { transform: translateX(-100%); }
}

/* Bottom nav */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background-color: rgba(43,43,43,0.9);
    z-index: 6;
    display: flex;
    justify-content: space-around;
    align-items: center;
}

.bottom-nav button {
    background: none;
    border: none;
    font-size: 14px;
    color: #f1f1f1;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.bottom-nav button i { font-size: 24px; }

/* Tabs */
.tab-content {
    display: none;
    position: absolute;
    top: 0;
    width: 100%;
    height: calc(100% - 60px);
    padding: 10px;
    background-color: rgba(40,40,40,0.95);
    z-index: 3;
    overflow-y: auto;
    pointer-events: none; /* IMPORTANT */
}

.tab-content.active {
    display: block;
    pointer-events: auto; /* IMPORTANT */
}

#world-map-tab {
    background: transparent;
    padding: 0;
    z-index: 1;
}

.enhanced-map.hd-quality-on {
    filter: contrast(1.5) brightness(1.2) saturate(1.8);
}
</style>

<!-- Prevent mobile browsers hijacking touchmove -->
<script>
document.addEventListener('touchmove', function () {}, { passive: false });
</script>

</head>
<body>

<!-- MAP -->
<div id="map" class="enhanced-map"></div>

<!-- RESOURCE BAR -->
<div class="resource-container">
    <div class="resource">
        <p>$<span id="money">1000</span></p>
        <p><span id="money-production">0</span> $/s</p>
    </div>
    <div class="resource">
        <p><span id="oil">0</span></p>
        <p><span id="oil-rig-production">0</span> barrels/s</p>
    </div>
    <div class="resource">
        <p><span id="energy">0</span></p>
        <p><span id="power-plant-production">0</span></p>
    </div>
    <div class="resource">
        <p>Efficiency: <span id="efficiency">100%</span></p>
    </div>
</div>

<!-- NEWS -->
<div class="news-ticker-container">
    <div id="newsTicker" class="news-ticker"></div>
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
    <button onclick="showTab('world-map-tab')"><i class="fas fa-globe"></i><span>World Map</span></button>
    <button onclick="showTab('controls-tab')"><i class="fas fa-cogs"></i><span>Controls</span></button>
    <button onclick="showTab('settings-tab')"><i class="fas fa-sliders-h"></i><span>Settings</span></button>
    <button onclick="showTab('stats-tab')"><i class="fas fa-chart-bar"></i><span>Stats</span></button>
</div>

<!-- TABS -->
<div id="world-map-tab" class="tab-content active"></div>

<div id="controls-tab" class="tab-content container-fluid">
    <div class="controls">
        <h3 class="text-center my-4">GeoTycoon</h3>
        <div class="button-container row justify-content-center">
            <button class="btn btn-primary m-2 col-5" onclick="buyLand()">Buy Land ($100)</button>
            <button class="btn btn-primary m-2 col-5" onclick="buyOilRig()">Buy Oil Rig ($500)</button>
            <button class="btn btn-primary m-2 col-5" onclick="buyPowerPlant()">Buy Power Plant ($1000)</button>
            <button class="btn btn-primary m-2 col-5" onclick="upgradeOilRig()">Upgrade Oil Rig ($300)</button>
            <button class="btn btn-primary m-2 col-5" onclick="upgradePowerPlant()">Upgrade Power Plant ($600)</button>
        </div>
        <div class="weather-info mt-4">
            <p class="text-center">Weather: <span id="weather">Fetching...</span></p>
        </div>
    </div>
</div>

<div id="settings-tab" class="tab-content container-fluid">
    <div class="settings">
        <h2 class="text-center my-4">Geo Map Settings</h2>

        <div class="form-group">
            <label>Animation Speed</label>
            <input type="range" class="form-control-range" min="1" max="10" value="5"
                   onchange="updateAnimationSpeed(this.value)">
        </div>

        <div class="form-group">
            <label>Map Theme</label>
            <select class="form-control" onchange="updateMapTheme(this.value)">
                <option value="EsriWorldImagery">World Imagery</option>
                <option value="street">Street Map</option>
                <option value="satellite">Satellite</option>
            </select>
        </div>

        <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" checked
                   onchange="toggleMarkers(this.checked)">
            <label class="form-check-label">Show Markers</label>
        </div>

        <div class="form-group">
            <label>HD Visual Effects</label>
            <label class="switch">
                <input type="checkbox" onchange="toggleGeoVisualEffects(this.checked)">
                <span class="slider"></span>
            </label>
        </div>
    </div>
</div>

<div id="stats-tab" class="tab-content container-fluid">
    <div class="stats">
        <h3 class="text-center my-4">Player Stats</h3>
        <ul class="list-group">
            <li class="list-group-item">Oil Extracted: <span id="total-oil">0</span></li>
            <li class="list-group-item">Energy Generated: <span id="total-energy">0</span></li>
            <li class="list-group-item">Buildings Placed: <span id="total-buildings">0</span></li>
            <li class="list-group-item">Lands Owned: <span id="total-lands">0</span></li>
            <li class="list-group-item">Total Money Produced: $<span id="total-money-produced">0</span></li>
        </ul>
        <p class="text-center mt-4">Version: <span id="version">1.0.0</span></p>
    </div>
</div>

<script>
function showTab(id) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if (id === 'world-map-tab' && window.map) {
        setTimeout(() => map.invalidateSize(), 150);
    }
}
</script>

<!-- LIBRARIES -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
<script src="https://unpkg.com/leaflet-providers@latest/leaflet-providers.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- GAME -->
<script src="game.js"></script>
<script src="switch.js"></script>
<script src="tapfeedback.js"></script>
<script src="sidebar.js"></script>
<script src="guide.js"></script>
<script src="news.js"></script>
<script src="weather.js"></script>

</body>
</html>
